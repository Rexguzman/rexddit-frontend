import React, { useState, useRef } from 'react';
import { connect } from 'react-redux';
import { Link } from 'react-router-dom';
import { HeaderContainer, MenuContainer } from './Header.styled';

import { logoutRequest } from '../../actions';
import { useOnClickOutside } from '../../hooks/useOnClickOutside';
const Header = (props) => {
  const { toggleTheme, theme, user, logoutRequest } = props;

  //---> navbar logic
  const [open, setOpen] = useState(false);
  const node = useRef();
  useOnClickOutside(node, () => setOpen(false));

  const handleOpen = () => {
    setOpen(!open);
  };

  //---> logout logic
  const handleLogout = () => {
    logoutRequest({});
  };

  return (
    <React.Fragment>
      <HeaderContainer>
        <div>
          <Link to="/">
            <figure className="logo">
              <svg width="40" height="40" viewBox="0 0 496 496">
                <path
                  fill="white"
                  d="M265.6,61.8c-15.4-1.1-27.8,10.3-27.8,25.7s11.8,26,26.4,24.8c-5.5-9.7-5.2-17,1.1-22.3s13.7-4.3,22.9,3.2C291,76.4,280.9,62.9,265.6,61.8Z"
                />
                <path
                  fill="white"
                  d="M248,0C111,0,0,111,0,248S111,496,248,496,496,385,496,248,385,0,248,0ZM435.5,219.3c-2.2-9.4-4-17.1-6.1-25.9l-35.7,23.7c-2.3-10.3-4.5-19.6-6.4-29-1-4.6-2.5-5.2-6.4-2.4-9.1,6.5-18.5,12.6-28.8,19.6-2.5-10.4-5.6-20.1-7-30.1-1.2-8.1-3.7-6-8.2-2.8-8.9,6.3-18,12.2-27.7,18.7-2.5-11-5.1-21.3-7.2-31.8-.8-4.4-2.1-4.8-5.6-2.4-15.9,10.9-31.8,21.8-47.8,32.4-3,2.1-3.5,3.8-2.6,7.3,3.4,13.5,6.8,27,9.2,40.7,1.3,7.2,3.6,5.7,7.8,2.7,8.9-6.3,18.1-12.3,28-19,2.4,10.4,5.3,20.2,6.9,30.3,1.2,6.9,3.4,5.7,7.7,2.7,8.9-6.4,18.1-12.3,27.8-18.9,2.8,12.4,5.5,24.1,8.5,37l35.8-23.6c2.7,11.9,5.2,22.8,7.9,34.4L410,266.6c-3.7,17.5-7.8,32.9-20.4,44.5-5.5,5-11.3,6.4-19.3,3.1A552.3,552.3,0,0,0,196,274.7c-4.3-.3-6-1.1-6.6-5.9-4.6-39.2-3.8-77.6,15.3-113.6,3.9-7.3-3.8-6.3-6.4-8.7s-5.1-1.6-7,2.2c-16.2,31.2-21.1,64.5-18.8,99.2.8,11.5,3.1,22.9,4.1,34.4.4,5.6,3.1,6.4,7.9,6.5a425.6,425.6,0,0,1,66,7.2c-18.6,36.7-23.6,75.4-21.5,115.3.3,4.7-1,5.9-5.7,5.9q-68.2-.3-136.4,0c-4.8,0-5.9-1.5-5.9-6.1.1-85.6-1.9-171.3,1-256.8,1.2-35.1,22.2-63.8,52.6-83.6,18.1-11.8,38.3-17.7,59.6-18.5A401.9,401.9,0,0,0,252.1,46c21.5-4,41.4,1.2,56.2,18.9,1.8,2.1,2.9,2.9,5.7,1.1,10.9-7,22.2-5.2,33,.2,15.2,7.7,27.2,19,35.1,34.2a23.8,23.8,0,0,0,8.7,9.6c18.2,11.8,34.9,25.6,51.7,39.3,12,9.8,13.5,21.8,10.5,35.2S444.5,207.8,435.5,219.3Z"
                />
              </svg>
            </figure>
            <h1>rexddit</h1>
          </Link>
          <nav>
            {user.img == null ? (
              <figure ref={node} onClick={handleOpen} className="autor-img">
                <svg width="40" height="40" viewBox="0 0 496 512">
                  <path
                    fill="white"
                    d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"
                  />
                </svg>
              </figure>
            ) : (
              <figure onClick={handleOpen} className="autor-img">
                <img src={user.img} alt="" />
              </figure>
            )}
            {theme === 'light' ? (
              <figure onClick={toggleTheme}>
                <svg viewBox="0 0 512 512" width="40" height="40">
                  <path
                    fill="yellow"
                    d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"
                  ></path>
                </svg>
              </figure>
            ) : (
              <figure onClick={toggleTheme}>
                <svg width="40" height="40" viewBox="0 0 438.1 437.7">
                  <path
                    fill="white"
                    d="M82.3,416l-9.6-5.8L55.1,396.5,41.5,383c-4.5-6-9-11.9-13.6-17.8l-5.8-9.4-2.8-4.7c-4-7.2-6.8-15-10-22.6a278,278,0,0,1-7-27.2A60.5,60.5,0,0,0,.7,290.1c-.2-5.6-.5-11.2-.7-16.7.9-3.2.4-6.4.5-9.6.9-15.4,4.2-30.3,8.8-44.9a277.1,277.1,0,0,1,12.4-27.2l7.1-11.2c4.1-5.4,8.3-10.7,12.5-16.1l13.8-13.7,18.4-14.3a54.2,54.2,0,0,0,8.9-5.4,269.2,269.2,0,0,1,27.3-12.5,178.6,178.6,0,0,1,55.1-9.4,192,192,0,0,1,30.3,3c7.4,4.2,7.6,10.6.4,15.1l-4.2,2.8a41,41,0,0,0-9.1,6.3,98.4,98.4,0,0,0-17.4,16.1,61.8,61.8,0,0,0-9.5,12.1,92.5,92.5,0,0,0-14.5,27.2l-.9,2.3a16.7,16.7,0,0,0-2.2,6.5l-1.6,4c-1,4.7-2.6,9.4-2.7,14.3-2,9-1.6,18.2-1.3,27.3a95.2,95.2,0,0,0,4,24.8,3,3,0,0,0,.7,2.4,102.6,102.6,0,0,0,11.7,28.2A102.1,102.1,0,0,0,164.7,324c1.3,1.6,2.4,3.4,4.2,4.5A100.5,100.5,0,0,0,192,347a75.2,75.2,0,0,0,17.7,9.4,33,33,0,0,0,9.5,3.5c8.8,3.6,18,5.1,27.3,6.1a96,96,0,0,0,27.3,0l9.8-1.3c3.7-.5,7.1.1,9,3.7s1,6.6-1.5,9.6l-3.9,4.9-13.5,13.4-17.8,13.8-10.3,6.4a250.9,250.9,0,0,1-26.3,12.2c-8.9,2.8-18.1,4.8-27.3,7a225.3,225.3,0,0,1-32.9,2c-15.6-.3-30.6-3.3-45.3-7.9l-4.2-1.2A204.8,204.8,0,0,1,82.3,416Z"
                  />
                  <path
                    fill="white"
                    d="M246.8,26.6,260.4,0l13.2,25.5c.2,1.1.5,2,1.8,2,8.3,4.7,16.8,9,25.4,12.9-.3,1.6-1.9,1.7-3,2.3L275.4,54.1a1.8,1.8,0,0,0-1.7,2c-4.7,8.2-8.8,16.6-12.7,25.2-1.9-.3-1.9-2.1-2.6-3.3-4.1-7.6-7.3-15.8-11.9-23.2-8.6-5.1-17.8-8.9-26.6-13.6.7-1.5,2.3-1.7,3.5-2.3l21.8-11.3A1.5,1.5,0,0,0,246.8,26.6Z"
                  />
                  <path
                    fill="white"
                    d="M412.3,191l-1.6.8-15.5,7.8a5.5,5.5,0,0,0-3.2,2.8c-2.6,5.5-5.3,10.9-8,16.4l-.6,1.4c-4.7,8.1-8.8,16.5-12.8,25h-1.5c-3.9-8.7-8.1-17.2-12.8-25.6l-.3-.7c-2.7-5.6-5.5-11.1-8.2-16.7a4.7,4.7,0,0,0-2.4-2.4l-16.4-8-2.3-1L301.8,178v-.6c8.7-4,17.3-8.3,25.6-13a1.7,1.7,0,0,0,1.6-.8l16.8-8.1a4.7,4.7,0,0,0,2.1-2.3l8.2-16.8,1.2-2.3c4.3-7.8,8.3-15.8,11.9-23.9h1.3c4.3,8.5,8.6,17,13,25.5,0,.7,0,1.3.7,1.6L392,153a5.3,5.3,0,0,0,2.3,2.6l16.4,8a1.8,1.8,0,0,0,1.6.8l25.8,13.5Z"
                  />
                </svg>
              </figure>
            )}
          </nav>
        </div>
      </HeaderContainer>
      {user.isLogged ? (
        <MenuContainer ref={node} open={open}>
          <Link to="/profile" onClick={handleOpen}>
            <div>
              <figure></figure>
              <p>Perfil</p>
            </div>
          </Link>
          <div
            onClick={() => {
              handleLogout();
              handleOpen();
            }}
          >
            <figure></figure>
            <p>Cerrar sesión</p>
          </div>
        </MenuContainer>
      ) : (
        <MenuContainer ref={node} open={open}>
          <Link to="/login" onClick={handleOpen}>
            <div>
              <figure></figure>
              <p>Iniciar sesión</p>
            </div>
          </Link>
          <Link to="/register" onClick={handleOpen}>
            <div>
              <figure></figure>
              <p>Registarse</p>
            </div>
          </Link>
        </MenuContainer>
      )}
    </React.Fragment>
  );
};

const mapDispatchToProps = {
  logoutRequest,
};

const mapStateToProps = (state) => {
  return {
    user: state.user,
  };
};

export default connect(mapStateToProps, mapDispatchToProps)(Header);
